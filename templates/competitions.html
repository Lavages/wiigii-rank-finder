<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competition Explorer ‚Ä¢ Wiigii's WCA</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.cubing.net/v0/css/@cubing/icons/css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
            background-image: radial-gradient(circle at 50% -20%, #3b0764 0%, #000000 75%);
        }

        .nav-active {
            color: #ff007f !important;
            border-bottom: 3px solid #ff007f;
            text-shadow: 0 0 10px rgba(255, 0, 127, 0.5);
        }

        .brand-logo {
            font-weight: 900;
            font-size: 2.5rem;
            letter-spacing: -2px;
            background: linear-gradient(to right, #ff007f, #7b2ff7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .brand-tag {
            background: linear-gradient(135deg, #ff007f, #7b2ff7);
            color: white;
            padding: 2px 10px;
            border-radius: 4px;
            margin-left: 4px;
            -webkit-text-fill-color: white;
            font-size: 1.5rem;
            vertical-align: middle;
        }

        .glass-card {
            background: rgba(15, 15, 15, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 0, 127, 0.1);
        }

        .event-icon {
            font-size: 1.8rem;
            vertical-align: middle;
            display: inline-block;
            margin-right: 4px;
            transition: all 0.3s ease;
        }

        @media (min-width: 640px) {
            .event-icon {
                font-size: 2.2rem;
            }
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #000;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(#ff007f, #7b2ff7);
            border-radius: 10px;
        }

        .scrollable-events {
            max-width: 320px;
            overflow-x: auto;
            white-space: nowrap;
            padding: 8px 0;
        }

        #match-mode-toggle:checked+.block+.dot {
            transform: translateX(1.5rem);
            background-color: #ff007f;
            box-shadow: 0 0 10px #ff007f;
        }

        .event-btn-active {
            border-color: #ff007f !important;
            background-color: rgba(255, 0, 127, 0.15) !important;
            box-shadow: 0 0 20px rgba(255, 0, 127, 0.3);
            color: #ff007f !important;
            transform: translateY(-2px);
        }

        .find-btn {
            background: #ff007f;
            color: black;
            box-shadow: 0 0 20px rgba(255, 0, 127, 0.2);
        }

        .find-btn:hover {
            background: #ff3399;
            box-shadow: 0 0 30px rgba(255, 0, 127, 0.4);
        }
    </style>
</head>

<body class="min-h-screen text-gray-100 p-2 sm:p-4 flex flex-col items-center">

    <nav
        class="w-full max-w-5xl mx-auto bg-[#111111]/90 rounded-t-2xl p-3 sm:p-4 flex flex-wrap justify-center items-center gap-2 sm:gap-5 sticky top-0 z-50 border-b border-pink-500/20 backdrop-blur-md">
        <a href="/"
            class="text-xs sm:text-sm text-gray-400 hover:text-[#ff007f] font-black px-2 uppercase tracking-tighter transition-colors">Rank
            Finder</a>
        <a href="/competitors"
            class="text-xs sm:text-sm text-gray-400 hover:text-[#ff007f] font-black px-2 uppercase tracking-tighter transition-colors">Competitors</a>
        <a href="/specialist"
            class="text-xs sm:text-sm text-gray-400 hover:text-[#ff007f] font-black px-2 uppercase tracking-tighter transition-colors">Specialist</a>
        <a href="/completionist"
            class="text-xs sm:text-sm text-gray-400 hover:text-[#ff007f] font-black px-2 uppercase tracking-tighter transition-colors">Completionist</a>
        <a href="/events"
            class="text-xs sm:text-sm text-gray-400 hover:text-[#ff007f] font-black px-2 uppercase tracking-tighter transition-colors">Events</a>
        <a href="/comparison"
            class="text-xs sm:text-sm text-gray-400 hover:text-[#ff007f] font-black px-2 uppercase tracking-tighter transition-colors">Comparison</a>
        <a href="/competitions"
            class="text-xs sm:text-sm font-black px-2 nav-active uppercase tracking-tighter transition-colors">Competitions</a>
    </nav>

    <main
        class="max-w-5xl w-full mx-auto glass-card rounded-b-2xl shadow-[0_20px_50px_rgba(0,0,0,0.5)] p-4 sm:p-10 space-y-10 border-x border-b border-pink-500/10 flex-grow">

        <header class="text-center">
            <h1 class="brand-logo text-white mb-2">Comp<span class="brand-tag">Explorer</span></h1>
            <p class="text-purple-400/60 text-[10px] font-black uppercase tracking-[0.4em] italic">Locate competitions
                by specific event combos</p>
        </header>

        <div class="space-y-6">
            <h3 class="text-center text-[10px] font-black uppercase tracking-[0.3em] text-gray-500">Select Target Events
            </h3>
            <div id="event-selector" class="flex flex-wrap justify-center gap-2 sm:gap-3"></div>
        </div>

        <div
            class="flex flex-col items-center justify-center gap-8 bg-black/40 p-8 rounded-2xl border border-white/5 shadow-inner">
            <label for="match-mode-toggle" class="flex items-center cursor-pointer group">
                <div class="relative">
                    <input type="checkbox" id="match-mode-toggle" class="sr-only">
                    <div class="block bg-gray-900 w-14 h-8 rounded-full border border-white/10"></div>
                    <div
                        class="dot absolute left-1 top-1 bg-gray-600 w-6 h-6 rounded-full transition transform translate-x-0">
                    </div>
                </div>
                <div class="ml-4">
                    <span id="match-mode-label"
                        class="font-black text-xs uppercase tracking-widest text-gray-500 select-none group-hover:text-[#ff007f] transition-colors">
                        Inclusive Match (Default)
                    </span>
                </div>
            </label>

            <button id="find-btn"
                class="find-btn w-full sm:w-auto px-12 py-4 rounded-xl font-black uppercase tracking-tighter text-lg active:scale-95 transition-all">
                Find Competitions
            </button>
        </div>

        <div id="loading-spinner" class="hidden flex flex-col items-center py-10 gap-4">
            <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-[#ff007f] border-r-transparent"></div>
            <p class="text-[#ff007f] font-black uppercase tracking-widest text-[10px] animate-pulse">Querying WCA
                Database...</p>
        </div>

        <div id="results-container" class="min-h-[100px] flex flex-col items-center">
            <p id="error-message"
                class="text-red-500 font-black uppercase text-xs tracking-widest hidden p-6 text-center bg-red-950/20 rounded-xl border border-red-900/50 w-full">
            </p>
            <div id="no-data-message"
                class="hidden text-center py-20 bg-black/40 rounded-3xl border border-dashed border-white/10 w-full">
                <p class="text-gray-600 font-black uppercase tracking-widest text-sm">No matches found for this
                    selection.</p>
            </div>
        </div>
    </main>

    <footer class="w-full max-w-5xl mx-auto text-center text-gray-600 text-xs sm:text-sm mt-8 pb-8 font-bold">
        <p>¬© 2026 Wiigii's WCA Tools ‚Ä¢ <span class="text-[#ff007f] uppercase tracking-widest">Live Database Sync</span>
        </p>
    </footer>

    <script>
        const EVENT_ICONS = {
            "333": '<span class="cubing-icon event-333 event-icon"></span>',
            "222": '<span class="cubing-icon event-222 event-icon"></span>',
            "444": '<span class="cubing-icon event-444 event-icon"></span>',
            "555": '<span class="cubing-icon event-555 event-icon"></span>',
            "666": '<span class="cubing-icon event-666 event-icon"></span>',
            "777": '<span class="cubing-icon event-777 event-icon"></span>',
            "333oh": '<span class="cubing-icon event-333oh event-icon"></span>',
            "333bf": '<span class="cubing-icon event-333bf event-icon"></span>',
            "333fm": '<span class="cubing-icon event-333fm event-icon"></span>',
            "clock": '<span class="cubing-icon event-clock event-icon"></span>',
            "minx": '<span class="cubing-icon event-minx event-icon"></span>',
            "pyram": '<span class="cubing-icon event-pyram event-icon"></span>',
            "skewb": '<span class="cubing-icon event-skewb event-icon"></span>',
            "sq1": '<span class="cubing-icon event-sq1 event-icon"></span>',
            "444bf": '<span class="cubing-icon event-444bf event-icon"></span>',
            "555bf": '<span class="cubing-icon event-555bf event-icon"></span>',
            "333mbf": '<span class="cubing-icon event-333mbf event-icon"></span>'
        };

        let selectedEvents = [];
        const eventSelector = document.getElementById("event-selector");
        const findBtn = document.getElementById("find-btn");
        const matchModeToggle = document.getElementById("match-mode-toggle");
        const matchModeLabel = document.getElementById("match-mode-label");
        const resultsContainer = document.getElementById("results-container");
        const spinner = document.getElementById("loading-spinner");
        const errorMsg = document.getElementById("error-message");
        const noData = document.getElementById("no-data-message");

        function getFormattedDate(competition) {
            const startDate = competition.date ? competition.date.from : null;
            const endDate = competition.date ? competition.date.till : null;
            if (!startDate) return "DATE TBA";
            try {
                const start = new Date(startDate + 'T00:00:00');
                const end = endDate ? new Date(endDate + 'T00:00:00') : start;
                const options = { month: 'short', day: 'numeric', year: 'numeric' };
                if (start.getTime() === end.getTime()) return start.toLocaleDateString('en-US', options).toUpperCase();
                return `${new Date(startDate + 'T00:00:00').toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${new Date(endDate + 'T00:00:00').toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`.toUpperCase();
            } catch (e) { return startDate; }
        }

        function getFormattedLocation(competition) {
            const loc = (competition.city && competition.country) ? `${competition.city}, ${competition.country}` : (competition.country || "TBA");
            return loc.toUpperCase();
        }

        matchModeToggle.addEventListener("change", () => {
            matchModeLabel.textContent = matchModeToggle.checked ? "Exact Match (Required Only)" : "Inclusive Match (Default)";
            matchModeLabel.classList.toggle("text-[#ff007f]", matchModeToggle.checked);
        });

        Object.entries(EVENT_ICONS).forEach(([id, icon]) => {
            const btn = document.createElement("button");
            btn.className = "bg-black/50 hover:border-gray-500 text-gray-400 rounded-xl p-3 border border-white/5 transition-all active:scale-90 flex items-center justify-center";
            btn.innerHTML = icon;
            btn.addEventListener("click", () => {
                btn.classList.toggle("event-btn-active");
                if (selectedEvents.includes(id)) selectedEvents = selectedEvents.filter(e => e !== id);
                else selectedEvents.push(id);
            });
            eventSelector.appendChild(btn);
        });

        findBtn.addEventListener("click", async () => {
            spinner.classList.remove("hidden");
            errorMsg.classList.add("hidden");
            noData.classList.add("hidden");
            resultsContainer.querySelectorAll(".dynamic-result").forEach(el => el.remove());

            if (selectedEvents.length === 0) {
                errorMsg.textContent = "SELECT AT LEAST ONE EVENT.";
                errorMsg.classList.remove("hidden");
                spinner.classList.add("hidden");
                return;
            }

            const partial = matchModeToggle.checked ? 'false' : 'true';
            const apiURL = `/competitions?events=${selectedEvents.join(",")}&partial=${partial}`;

            try {
                const res = await fetch(apiURL);
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || "Search failed");
                if (data.length === 0) {
                    noData.classList.remove("hidden");
                    return;
                }

                const tableHtml = `
                    <div class="hidden sm:block w-full dynamic-result border border-white/5 rounded-xl overflow-hidden mt-6 bg-black/20">
                        <table class="w-full text-left">
                            <thead class="bg-white/5 border-b border-white/5">
                                <tr>
                                    <th class="px-6 py-4 text-[10px] font-black text-gray-500 uppercase tracking-widest">Competition</th>
                                    <th class="px-6 py-4 text-[10px] font-black text-gray-500 uppercase tracking-widest">Location</th>
                                    <th class="px-6 py-4 text-[10px] font-black text-gray-500 uppercase tracking-widest">Date</th>
                                    <th class="px-6 py-4 text-[10px] font-black text-[#ff007f] uppercase tracking-widest">Events</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-white/5">
                                ${data.map(c => `
                                    <tr class="hover:bg-[#ff007f]/5 transition-colors group">
                                        <td class="px-6 py-5">
                                            <a href="https://www.worldcubeassociation.org/competitions/${c.id}" target="_blank" class="font-black text-white uppercase tracking-tighter group-hover:text-[#ff007f] transition-colors block">${c.name}</a>
                                        </td>
                                        <td class="px-6 py-5 text-xs font-bold text-gray-500">${getFormattedLocation(c)}</td>
                                        <td class="px-6 py-5 text-xs font-bold text-gray-400 whitespace-nowrap">${getFormattedDate(c)}</td>
                                        <td class="px-6 py-5">
                                            <div class="scrollable-events">${c.events.map(e => EVENT_ICONS[e] || e).join("")}</div>
                                        </td>
                                    </tr>
                                `).join("")}
                            </tbody>
                        </table>
                    </div>`;

                const cardsHtml = `
                    <div class="sm:hidden flex flex-col gap-4 w-full dynamic-result mt-6">
                        ${data.map(c => `
                            <div class="bg-black/40 border border-white/10 rounded-2xl p-6 shadow-xl">
                                <a href="https://www.worldcubeassociation.org/competitions/${c.id}" target="_blank" class="text-xl font-black text-[#ff007f] uppercase tracking-tighter block mb-3">${c.name}</a>
                                <div class="space-y-2 text-[10px] font-black text-gray-500 uppercase tracking-widest mb-6">
                                    <p class="flex items-center gap-2">üìç ${getFormattedLocation(c)}</p>
                                    <p class="flex items-center gap-2">üìÖ ${getFormattedDate(c)}</p>
                                </div>
                                <div class="pt-4 border-t border-white/5">
                                    <div class="flex flex-wrap items-center gap-1">${c.events.map(e => EVENT_ICONS[e] || e).join("")}</div>
                                </div>
                            </div>
                        `).join("")}
                    </div>`;

                resultsContainer.insertAdjacentHTML("beforeend", tableHtml + cardsHtml);
            } catch (err) {
                errorMsg.textContent = "DATA RETRIEVAL FAILED.";
                errorMsg.classList.remove("hidden");
            } finally {
                spinner.classList.add("hidden");
            }
        });
    </script>
</body>

</html>